generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Jobs {
  id           Int       @id @default(autoincrement())
  date         DateTime
  driver       String
  customer     String
  truckType    String
  comments     String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  billTo       String
  chargedHours Float?
  driverCharge Float?
  dropoff      String
  invoiced     Boolean?
  pickup       String
  registration String
  runsheet     Boolean?
  finishTime       DateTime?
  startTime        DateTime?
  attachmentRunsheet   String[]  @default([])
  attachmentDocket     String[]  @default([])
  attachmentDeliveryPhotos String[] @default([])
  jobReference String?
  eastlink     Int?
  citylink     Int?
  
  @@index([jobReference])
  @@index([eastlink, citylink])
}

model Customer {
  id             Int      @id @default(autoincrement())
  customer       String
  billTo         String
  contact        String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  comments       String?
  fuelLevy       Int?
  tray           Int?
  crane          Int?
  semi           Int?
  semiCrane      Int?
  tolls          Boolean  @default(false)
  breakDeduction Float?
}

model Vehicle {
  id                Int      @id @default(autoincrement())
  registration      String   @unique
  expiryDate        DateTime
  make              String
  model             String
  yearOfManufacture Int
  type              String
  carryingCapacity  String?
  trayLength        String?
  craneReach        String?
  craneType         String?
  craneCapacity     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Driver {
  id        Int      @id @default(autoincrement())
  driver    String   @unique
  truck     String
  tray      Int?
  crane     Int?
  semi      Int?
  semiCrane Int?
  breaks    Float?
  type      String   @default("Employee")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  fuelLevy  Int?
  tolls     Boolean  @default(false)
}

model User {
  id        String   @id // Clerk user ID
  email     String   @unique
  firstName String?
  lastName  String?
  imageUrl  String?
  role      String   @default("user") // admin, manager, user, viewer
  isActive  Boolean  @default(true)
  lastLogin DateTime?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([email])
  @@index([role])
  @@index([isActive])
}

model ActivityLog {
  id          Int      @id @default(autoincrement())
  userId      String
  userEmail   String?
  action      String
  tableName   String
  recordId    String
  oldData     Json?
  newData     Json?
  description String
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([tableName])
  @@index([createdAt])
}

model GoogleDriveSettings {
  id            Int      @id @default(autoincrement())
  userId        String   // Clerk user ID
  driveId       String   // Google Drive shared drive ID
  driveName     String   // Human readable drive name
  baseFolderId  String   // Base folder ID for attachments
  folderName    String   // Human readable folder name
  folderPath    String[] // Full folder path array for navigation
  purpose       String   @default("job_attachments") // job_attachments, general_storage, etc
  isActive      Boolean  @default(true)
  isGlobal      Boolean  @default(false) // Global settings for all users (admin-managed)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([userId, purpose, isActive])
  @@index([isGlobal, purpose, isActive])
}
