generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Jobs {
  id                       Int       @id @default(autoincrement())
  date                     DateTime
  driver                   String
  customer                 String
  truckType                String
  comments                 String?
  createdAt                DateTime  @default(now())
  updatedAt                DateTime  @updatedAt
  billTo                   String
  chargedHours             Float?
  driverCharge             Float?
  dropoff                  String?
  invoiced                 Boolean?
  pickup                   String
  registration             String
  runsheet                 Boolean?
  finishTime               DateTime?
  startTime                DateTime?
  attachmentDeliveryPhotos String[]  @default([])
  attachmentDocket         String[]  @default([])
  attachmentRunsheet       String[]  @default([])
  citylink                 Int?
  eastlink                 Int?
  jobReference             String?

  @@index([jobReference])
  @@index([eastlink, citylink])
}

model Customer {
  id             Int      @id @default(autoincrement())
  customer       String
  billTo         String
  contact        String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  comments       String?
  fuelLevy       Int?
  tray           Int?
  crane          Int?
  semi           Int?
  semiCrane      Int?
  tolls          Boolean  @default(false)
  breakDeduction Float?
}

model Vehicle {
  id                Int      @id @default(autoincrement())
  registration      String   @unique
  expiryDate        DateTime
  make              String
  model             String
  yearOfManufacture Int
  type              String
  carryingCapacity  String?
  trayLength        String?
  craneReach        String?
  craneType         String?
  craneCapacity     String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model Driver {
  id              Int      @id @default(autoincrement())
  driver          String   @unique
  truck           String
  tray            Int?
  crane           Int?
  semi            Int?
  semiCrane       Int?
  breaks          Float?
  type            String   @default("Employee")
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  fuelLevy        Int?
  tolls           Boolean  @default(false)
  address         String?
  abn             String?
  gstStatus       String   @default("not_registered")
  gstMode         String   @default("exclusive")
  bankAccountName String?
  bankBsb         String?
  bankAccountNumber String?
  rctis           Rcti[]
}

model User {
  id        String    @id
  email     String    @unique
  firstName String?
  lastName  String?
  imageUrl  String?
  role      String    @default("user")
  isActive  Boolean   @default(true)
  lastLogin DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  @@index([email])
  @@index([role])
  @@index([isActive])
}

model ActivityLog {
  id          Int      @id @default(autoincrement())
  userId      String
  userEmail   String?
  action      String
  tableName   String
  recordId    String
  oldData     Json?
  newData     Json?
  description String
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([userId])
  @@index([tableName])
  @@index([createdAt])
}

model GoogleDriveSettings {
  id           Int      @id @default(autoincrement())
  userId       String
  driveId      String
  driveName    String
  baseFolderId String
  folderName   String
  folderPath   String[]
  purpose      String   @default("job_attachments")
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  isGlobal     Boolean  @default(false)

  @@index([userId, purpose, isActive])
  @@index([isGlobal, purpose, isActive])
}

model Rcti {
  id                Int        @id @default(autoincrement())
  driverId          Int
  driver            Driver     @relation(fields: [driverId], references: [id], onDelete: Cascade)
  driverName        String
  driverAddress     String?
  driverAbn         String?
  gstStatus         String
  gstMode           String
  bankAccountName   String?
  bankBsb           String?
  bankAccountNumber String?
  weekEnding        DateTime
  invoiceNumber     String     @unique
  subtotal          Float
  gst               Float
  total             Float
  status            String     @default("draft")
  notes             String?
  paidAt            DateTime?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  lines             RctiLine[]

  @@index([driverId])
  @@index([weekEnding])
  @@index([status])
}

model RctiLine {
  id            Int      @id @default(autoincrement())
  rctiId        Int
  rcti          Rcti     @relation(fields: [rctiId], references: [id], onDelete: Cascade)
  jobId         Int
  jobDate       DateTime
  customer      String
  truckType     String
  description   String?
  chargedHours  Float
  ratePerHour   Float
  amountExGst   Float
  gstAmount     Float
  amountIncGst  Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([rctiId])
  @@index([jobId])
}
